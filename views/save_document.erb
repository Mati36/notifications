<!DOCTYPE html>
<html lang="es"> 
    <head>
        <meta charset = "utf-8">
        <title>save_document</title>
        <link rel="stylesheet" href="css/loginStyle.css">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb" crossorigin="anonymous">

    </head>
    <body>
        <div class="save_document">
            <form action="save_document" method="POST" enctype="multipart/form-data">
                <label for="title">Titulo</label> 
                <input type="text" name="title"> <br>
                <label for="description">Descripcion</label> 
                <input type="text" name="description"> <br>
                <label for="tag" >Tags</label> 
                <input type="text" name="tag" id="tag">
                <div name="name_user" id="tag_name_user" class="w3-large ">
                    <ul id="filter_users"> 
                    </ul>
                </div> <br>
                <label for="type" >Tipo</label> 
                <select id="type" name="type"> 
                    <option value="Act">Acta</option>
                    <option value="Resolution">Resolucion</option>
                </select> <br>
                <label for="select_topic" >Tendencia</label> 
                <select id="select_topic" name="topics"> 
                    <%@topics.each do |topic|%>
                        <option value="<%=topic.id%>"><%=topic.name%></option>
                    <%end%>
                </select> <br>
                <input name="fileInput" type="file" accept= ".pdf, .jpg, .jpeg, .png"  /> <br>
                <input type="submit" value="Subir Documento"> 
            </form>
        </div>
        <script> 
            users = <%= @users%>;
             
            var search = document.getElementById('tag');
            var user_ul = document.getElementById('filter_users');
            var select_user=[];

            search.innerHTML = '';
            search.addEventListener('keyup',e => {
                var lastChar = select_user.join('').length;    
                var text = search.value.charAt(lastChar);
               
                if (search.value.length < lastChar)
                   deselect(select_user);
                
                user_ul.innerHTML = '';
                if (text != ''){
                    
                    var users_list = users.filter( function (user) {
                        return (user.dni.toString().indexOf(text) > -1)
                    });

                    for (let i = 0; i < users_list.length; i++) {
                        
                        user_ul.innerHTML += ` <li id='user_${i}' class="w3-hover-light-green" >
                                                    ${ users_list[i].name } ${users_list[i].lastname}
                                                    (${users_list[i].dni})
                                                </li> `;
                    }

                    for (let i = 0; i < users_list.length; i++) {
                        document.getElementById('user_'+i).addEventListener('click', e=> {
                            select_user.push('@' + users_list[i].dni.toString());
                            search.value ='';
                            for (let i = 0; i < select_user.length; i++) {
                                search.value += select_user[i];    
                            }
                            user_ul.innerHTML = '';
                        }); 
                    }
                }
                
            });
            
            function deselect(select_user) {
                select_user.pop();
            }
      
        </script>
    </body>
</html>